<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0"
    />
    <title>Unity WebGL Firebase Test</title>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
        background: black;
      }

      canvas {
        width: 100% !important;
        height: 100% !important;
        background: #000;
        display: block;
      }
    </style>

    <!-- ✅ Firebase SDK (старая версия, подходящая для Unity WebGL) -->
     <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>

    <script>
       // Включаем debug режим — чтобы DebugView точно сработал
      
      const firebaseConfig = {
        apiKey: "AIzaSyBbQn_8VcMjx5YUUSov8MRVLeDeo5wUNuA",
        authDomain: "promoithub.firebaseapp.com",
        databaseURL: "https://promoithub-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "promoithub",
        storageBucket: "promoithub.firebasestorage.app",
        messagingSenderId: "744750948753",
        appId: "1:744750948753:web:8576dbb3800f661044fa30",
        measurementId: "G-WN4N1B0WGL"
      };

      firebase.initializeApp(firebaseConfig);
      const analytics = firebase.analytics();

      // ✅ Включаем сбор аналитики явно
      firebase.analytics().setAnalyticsCollectionEnabled(true);

      // ✅ Функция для Unity
      function sendAnalyticsEvent(eventName, paramsJson) {
        try {
          const params = JSON.parse(paramsJson);
          analytics.logEvent(eventName, params);
          console.log("[Firebase] Event sent:", eventName, params);
        } catch (e) {
          console.error("[Firebase] Error parsing params", e);
        }
      }
       
    </script>
  </head>

  <body>
    <canvas id="unity-canvas" width="960" height="600"></canvas>

    <!-- Замените пути на свои файлы билда -->
    <script src="Build/TestBuild.loader.js"></script>
    <script>
       let telegramAppChatLabs = window.Telegram.WebApp;
      let firstName = telegramAppChatLabs.initDataUnsafe.user.username;
      var gameInstance = null;
      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/TestBuild.data",
        frameworkUrl: "Build/TestBuild.framework.js",
        codeUrl: "Build/TestBuild.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "promoIthub",
        productVersion: "1.0",
      }).then((unityInstance) => {
            myGameInstance = unityInstance;
            myGameInstance.SendMessage('TELEGRAM', 'JsSendInfo', firstName);
            
        });
    </script>
    <script>
      Telegram.WebApp.expand()
      Telegram.WebApp.ready()
    </script>
  </body>
</html>
